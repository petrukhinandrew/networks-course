# Практика 7. Транспортный уровень

## Wireshark: TCP (5 баллов)

### Перехват TCP-передачи данных от вашего компьютера удаленному серверу
При ответе на вопросы прикладывайте соответствующие скрины программы Wireshark.

#### Подготовка
1. Откройте веб-браузер и перейдите по ссылке gaia.cs.umass.edu/wireshark-labs/alice.txt.
   Здесь вы найдете копию книги «Алиса в стране чудес» в формате ASCII. Сохраните этот файл 
   на свой компьютер.
2. Перейдите по ссылке: gaia.cs.umass.edu/wireshark-labs/TCP-wireshark-file1.html. Сюда вы
   будете загружать ранее сохраненный файл.
3. Запустите Wireshark и начните перехват пакетов.
4. Теперь загрузите текстовый файл «Алиса в стране чудес» на указанной в п.2 страничке.
5. Остановите захват пакетов в приложении Wireshark. Используйте фильтр пакетов tcp.

#### Вопросы
1. Какой IP-адрес и номер порта TCP использует ваш компьютер (отправитель), передающий
   файл серверу gaia.cs.umass.edu? Для ответа на вопрос, возможно, проще выбрать http-сообщение
   и рассмотреть информацию TCP-пакета, используемого для передачи этого http-сообщения, 
   в окне деталей заголовка пакета.
   - <!-- todo -->
2. Каков IP-адрес у сервера gaia.cs.umass.edu? Каковы номера портов для отправки и приема
   TCP-сегментов этого соединения?
   - <!-- todo -->
   - <!-- todo -->
3. Какой порядковый номер у SYN TCP-сегмента, который используется для установления
   TCP-соединения между компьютером клиента и сервером gaia.cs.umass.edu? Как
   определяется, что это именно SYN-сегмент?
   - <!-- todo -->
   - <!-- todo -->
4. Какой порядковый номер у SYNACK-сегмента, отправленного сервером gaia.cs.umass.edu
   на компьютер клиента в ответ на SYN-сегмент? Какое значение хранится в поле
   подтверждения в SYNACK-сегменте? Как сервер gaia.cs.umass.edu определил это значение?
   Как определяется, что это именно SYNACK-сегмент?
   - <!-- todo -->
   - <!-- todo -->
   - <!-- todo -->
   - <!-- todo -->
5. Какой порядковый номер у TCP-сегмента, содержащего команду POST протокола HTTP?
   (для нахождения команды POST вам потребуется проникнуть внутрь поля содержимого
   пакета в нижней части окна Wireshark, чтобы найти сегмент, в поле DATA которого
   хранится значение POST)
   - <!-- todo -->
6. Рассмотрите TCP-сегмент, содержащий команду POST протокола HTTP, как первый TCP-сегмент 
   соединения. Какие порядковые номера у первых шести сегментов TCP-соединения 
   (включая сегмент, содержащий команду POST протокола HTTP)? Когда был
   отправлен каждый сегмент? Когда был получен ACK-пакет для каждого сегмента?
   Покажите разницу между тем, когда каждый TCP-сегмент был отправлен и когда было
   получено каждое подтверждение, чему равно значение RTT для каждого из 6 сегментов?
   - <!-- todo -->
   - <!-- todo -->
   - <!-- todo -->
   - <!-- todo -->
7. Чему равна пропускная способность (количество байтов, передаваемых в единицу
   времени) для этого TCP-соединения? Объясните, как вы получили это значение.
   - <!-- todo -->
   - <!-- todo -->

### Работа с Time-Sequence-Graph (Stevens) (2 балла)
Time-Sequence-Graph (Stevens) (Временная шкала (Стивенса)) – одна из графических утилит
Wireshark для протокола TCP. Для того, чтобы ее запустить, выберите TCP-сегмент в окне
захваченных полученных пакетов. Затем выберите команду меню Statistics => TCP Stream Graph =>
Time-Sequence-Graph (Stevens) (Статистика => График TCP потока => Временная шкала (Стивенса)).
Каждая точка представляет отправленный TCP-сегмент, на графике изображена зависимость
порядкового номера сегмента от времени, когда он был отправлен.

#### Подготовка (такая же, как в предыдущем задании)
1. Откройте веб-браузер и перейдите по ссылке gaia.cs.umass.edu/wireshark-labs/alice.txt.
   Здесь вы найдете копию книги «Алиса в стране чудес» в формате ASCII. Сохраните этот файл на
   свой компьютер.
2. Перейдите по ссылке: gaia.cs.umass.edu/wireshark-labs/TCP-wireshark-file1.html. Сюда вы
   будете загружать ранее сохраненный файл.
3. Запустите Wireshark и начните перехват пакетов
4. Теперь загрузите текстовый файл «Алиса в стране чудес» на указанной в п.2 страничке
5. Остановите захват пакетов в приложении Wireshark. Используйте фильтр пакетов tcp.

#### Задание
Используйте инструмент построения графиков Time-Sequence-Graph (Stevens), чтобы представить
изменение порядковых номеров на временной шкале для сегментов, отправленных от клиента
серверу gaia.cs.umass.edu. Приложите соответствующий скрин программы Wireshark.

#### Скрин
todo

## Программирование. Эхо-запросы через UDP
Реализуйте сервер для пингования, а также его клиента.

### А. Серверная часть (2 балла)
Сервер находится в бесконечном цикле, ожидая приходящие UDP-пакеты.
Если пакет прибывает, то сервер просто изменяет символы входящего сообщения на заглавные и
отправляет их обратно клиенту. Серверный код должен моделировать 20% потерю пакетов.

#### Демонстрация работы

![](images/server-sol.png)

### Б. Клиентская часть (2 балла)
Клиент должен отправить 10 эхо-запросов серверу. Поскольку UDP является ненадежным с точки
зрения доставки протоколом, то пакет, отправленный от клиента к серверу или наоборот, может
быть потерян в сети. Так как клиент не может бесконечно ждать ответа на запрос, нужно задать
период ожидания ответа (тайм-аут), равный одной секунде – если ответ не будет получен в
течение одной секунды, клиентская программа должна предполагать, что пакет потерян.

Ваша клиентская программа должна:
- отправить эхо-запрос, используя UDP
- распечатать ответное сообщение от сервера (если такое есть)
- вычислить и вывести на печать время оборота (RTT) в секундах для каждого пакета при
ответе сервера
- в противном случае, вывести сообщение «Request timed out»

Формат сообщения:
`Ping номер_последовательности время`
- номер_последовательности начинается с 1 и увеличивается до 10 для каждого
последующего сообщения, отправленного клиентом
- время – это момент времени, когда клиент отправляет сообщение

Сделайте скриншоты, подтверждающие корректную работу вашей программы пингования со стороны клиента.

#### Демонстрация работы

В логах есть поле `got n bytes response ... time=t`, где `t` - RTT
![](images/client-sol.png)

### В. Вывод в формате ping (2 балла)
Версия клиента из предыдущей части (Б) вычисляет время оборота для каждого пакета и выводит
его отдельно. Измените вывод таким образом, чтобы он соответствовал тому, как это делается в
стандартной утилите ping.

Для этого вам нужно будет сообщить минимальное, максимальное и среднее значение RTT в
конце каждого ответа от сервера. Дополнительно вычислите коэффициент потери пакетов (в
процентах).

#### Демонстрация работы

![](images/client-loss.png)

### Г. UDP Heartbeat (4 балла)
UDP Heartbeat (монитор доступности) подобен программе пингования. Он может быть
использован для проверки, работает ли приложение, и вывода сообщения об односторонней
потере пакетов.

Клиент отправляет порядковый номер и текущую временную метку в пакете UDP на сервер,
который слушает «сердцебиение» (т.е. ожидает UDP-пакеты) клиента. После получения пакетов
сервер вычисляет разницу во времени и сообщает о потерях. Если пакеты отсутствуют
определенный период времени, заданный параметром, то делается предположение, что
клиентское приложение остановлено и соответствующее сообщение выводится на консоль
сервера.

Реализуйте UDP Heartbeat (обе части – клиент и сервер), доработав обе ваши части программы
пингования из заданий А и Б.

Обратите внимание, что клиентов у сервера может быть сразу несколько одновременно.
Протестируйте такой сценарий.

#### Демонстрация работы

Формат запроса серверу `HB X TS` где `X` - номер пакета, `TS` время в формате RFC3339Nano

![](images/heartbeat.png)

Скриншот для 5 одновременных клиентов не входит, поэтому прикладываю логи

Сервер:
```bash
petrukhinandrew@petrukhinandrew:~/Documents/networks-course/lab07/echo-server/server$ go run main.go -m heartbeat -t 5
2024/04/04 19:23:18 Serving on :8080
2024/04/04 19:23:18 running heartbeat mode
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 1 at 2024-04-04 19:23:25.299701635 +0300 MSK with 0.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 2 at 2024-04-04 19:23:25.299867712 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 3 at 2024-04-04 19:23:25.299927496 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 4 at 2024-04-04 19:23:25.299974509 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 5 at 2024-04-04 19:23:25.300013065 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 6 at 2024-04-04 19:23:25.300056963 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 7 at 2024-04-04 19:23:25.300107235 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 8 at 2024-04-04 19:23:25.300147173 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 9 at 2024-04-04 19:23:25.300184913 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:42432
2024/04/04 19:23:25 127.0.0.1:42432 status: last packet 10 at 2024-04-04 19:23:25.300220232 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:42432
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 1 at 2024-04-04 19:23:25.310541913 +0300 MSK with 0.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 2 at 2024-04-04 19:23:25.310652325 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 3 at 2024-04-04 19:23:25.310708762 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 4 at 2024-04-04 19:23:25.310757393 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 5 at 2024-04-04 19:23:25.310791076 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 6 at 2024-04-04 19:23:25.310829528 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 7 at 2024-04-04 19:23:25.310861023 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 8 at 2024-04-04 19:23:25.31089821 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 9 at 2024-04-04 19:23:25.310929908 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:33405
2024/04/04 19:23:25 127.0.0.1:33405 status: last packet 10 at 2024-04-04 19:23:25.310968079 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:33405
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 1 at 2024-04-04 19:23:25.321273592 +0300 MSK with 0.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 2 at 2024-04-04 19:23:25.321387975 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 3 at 2024-04-04 19:23:25.321437865 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 4 at 2024-04-04 19:23:25.32147768 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 5 at 2024-04-04 19:23:25.321533224 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 6 at 2024-04-04 19:23:25.321570626 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 7 at 2024-04-04 19:23:25.321613336 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 8 at 2024-04-04 19:23:25.32165137 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 9 at 2024-04-04 19:23:25.321694613 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:34763
2024/04/04 19:23:25 127.0.0.1:34763 status: last packet 10 at 2024-04-04 19:23:25.321737663 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:34763
2024/04/04 19:23:25 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:25 127.0.0.1:49960 status: last packet 1 at 2024-04-04 19:23:25.332108307 +0300 MSK with 0.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:49960
2024/04/04 19:23:25 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:25 127.0.0.1:49960 status: last packet 2 at 2024-04-04 19:23:25.332272137 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:49960
2024/04/04 19:23:25 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:25 127.0.0.1:49960 status: last packet 3 at 2024-04-04 19:23:25.332329601 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:49960
2024/04/04 19:23:25 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:25 127.0.0.1:49960 status: last packet 4 at 2024-04-04 19:23:25.332382283 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:49960
2024/04/04 19:23:25 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:25 127.0.0.1:49960 status: last packet 5 at 2024-04-04 19:23:25.332433738 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:49960
2024/04/04 19:23:25 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:25 127.0.0.1:49960 status: last packet 6 at 2024-04-04 19:23:25.332490469 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:49960
2024/04/04 19:23:25 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:25 simulating 20%% loss
2024/04/04 19:23:25 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:25 127.0.0.1:51579 status: last packet 1 at 2024-04-04 19:23:25.342491221 +0300 MSK with 0.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:51579
2024/04/04 19:23:25 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:25 127.0.0.1:51579 status: last packet 2 at 2024-04-04 19:23:25.342664228 +0300 MSK with -100.000000% loss
2024/04/04 19:23:25 sent response to 127.0.0.1:51579
2024/04/04 19:23:25 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:25 simulating 20%% loss
2024/04/04 19:23:26 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:26 127.0.0.1:49960 status: last packet 8 at 2024-04-04 19:23:26.334048702 +0300 MSK with -100.000000% loss
2024/04/04 19:23:26 sent response to 127.0.0.1:49960
2024/04/04 19:23:26 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:26 127.0.0.1:49960 status: last packet 9 at 2024-04-04 19:23:26.334329018 +0300 MSK with -100.000000% loss
2024/04/04 19:23:26 sent response to 127.0.0.1:49960
2024/04/04 19:23:26 got package bytes from 127.0.0.1:49960
2024/04/04 19:23:26 simulating 20%% loss
2024/04/04 19:23:26 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:26 simulating 20%% loss
2024/04/04 19:23:27 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:27 127.0.0.1:51579 status: last packet 5 at 2024-04-04 19:23:27.34439363 +0300 MSK with -100.000000% loss
2024/04/04 19:23:27 sent response to 127.0.0.1:51579
2024/04/04 19:23:27 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:27 127.0.0.1:51579 status: last packet 6 at 2024-04-04 19:23:27.344745995 +0300 MSK with -100.000000% loss
2024/04/04 19:23:27 sent response to 127.0.0.1:51579
2024/04/04 19:23:27 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:27 127.0.0.1:51579 status: last packet 7 at 2024-04-04 19:23:27.344989056 +0300 MSK with -100.000000% loss
2024/04/04 19:23:27 sent response to 127.0.0.1:51579
2024/04/04 19:23:27 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:27 simulating 20%% loss
2024/04/04 19:23:28 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:28 127.0.0.1:51579 status: last packet 9 at 2024-04-04 19:23:28.345400818 +0300 MSK with -100.000000% loss
2024/04/04 19:23:28 sent response to 127.0.0.1:51579
2024/04/04 19:23:28 got package bytes from 127.0.0.1:51579
2024/04/04 19:23:28 127.0.0.1:51579 status: last packet 10 at 2024-04-04 19:23:28.345790643 +0300 MSK with -100.000000% loss
2024/04/04 19:23:28 sent response to 127.0.0.1:51579
2024/04/04 19:23:31 removing client 127.0.0.1:42432 after 6.174158139s
2024/04/04 19:23:31 removing client 127.0.0.1:33405 after 6.163447641s
2024/04/04 19:23:31 removing client 127.0.0.1:34763 after 6.152684696s
2024/04/04 19:23:31 removing client 127.0.0.1:49960 after 5.140097529s
2024/04/04 19:23:33 removing client 127.0.0.1:51579 after 5.630279223s
```

Клиент:
```bash
petrukhinandrew@petrukhinandrew:~/Documents/networks-course/lab07/echo-server/client$ go run main.go -m heartbeat -c 5
2024/04/04 19:23:25 running client in heartbeat mode with 5 clients
2024/04/04 19:23:25 starting client 0
2024/04/04 19:23:25 client 0 on 127.0.0.1:42432
2024/04/04 19:23:25 client 0 sent 0 HB
2024/04/04 19:23:25 client 0 got response. time: 152.82µs
2024/04/04 19:23:25 client 0 sent 1 HB
2024/04/04 19:23:25 client 0 got response. time: 53.796µs
2024/04/04 19:23:25 client 0 sent 2 HB
2024/04/04 19:23:25 client 0 got response. time: 42.291µs
2024/04/04 19:23:25 client 0 sent 3 HB
2024/04/04 19:23:25 client 0 got response. time: 35.53µs
2024/04/04 19:23:25 client 0 sent 4 HB
2024/04/04 19:23:25 client 0 got response. time: 40.924µs
2024/04/04 19:23:25 client 0 sent 5 HB
2024/04/04 19:23:25 client 0 got response. time: 43.797µs
2024/04/04 19:23:25 client 0 sent 6 HB
2024/04/04 19:23:25 client 0 got response. time: 36.183µs
2024/04/04 19:23:25 client 0 sent 7 HB
2024/04/04 19:23:25 client 0 got response. time: 33.739µs
2024/04/04 19:23:25 client 0 sent 8 HB
2024/04/04 19:23:25 client 0 got response. time: 32.178µs
2024/04/04 19:23:25 client 0 sent 9 HB
2024/04/04 19:23:25 client 0 got response. time: 29.258µs
2024/04/04 19:23:25 client 0: rtt min/avg/max/mdev = 29.258µs/50.051µs/152.82µs/43µs
2024/04/04 19:23:25 client 0: package loss = 0%
2024/04/04 19:23:25 starting client 1
2024/04/04 19:23:25 client 1 on 127.0.0.1:33405
2024/04/04 19:23:25 client 1 sent 0 HB
2024/04/04 19:23:25 client 1 got response. time: 100.986µs
2024/04/04 19:23:25 client 1 sent 1 HB
2024/04/04 19:23:25 client 1 got response. time: 50.58µs
2024/04/04 19:23:25 client 1 sent 2 HB
2024/04/04 19:23:25 client 1 got response. time: 45.113µs
2024/04/04 19:23:25 client 1 sent 3 HB
2024/04/04 19:23:25 client 1 got response. time: 29.233µs
2024/04/04 19:23:25 client 1 sent 4 HB
2024/04/04 19:23:25 client 1 got response. time: 35.32µs
2024/04/04 19:23:25 client 1 sent 5 HB
2024/04/04 19:23:25 client 1 got response. time: 27.583µs
2024/04/04 19:23:25 client 1 sent 6 HB
2024/04/04 19:23:25 client 1 got response. time: 34.092µs
2024/04/04 19:23:25 client 1 sent 7 HB
2024/04/04 19:23:25 client 1 got response. time: 27.948µs
2024/04/04 19:23:25 client 1 sent 8 HB
2024/04/04 19:23:25 client 1 got response. time: 34.378µs
2024/04/04 19:23:25 client 1 sent 9 HB
2024/04/04 19:23:25 client 1 got response. time: 33.211µs
2024/04/04 19:23:25 client 1: rtt min/avg/max/mdev = 27.583µs/41.844µs/100.986µs/33µs
2024/04/04 19:23:25 client 1: package loss = 0%
2024/04/04 19:23:25 starting client 2
2024/04/04 19:23:25 client 2 on 127.0.0.1:34763
2024/04/04 19:23:25 client 2 sent 0 HB
2024/04/04 19:23:25 client 2 got response. time: 104.072µs
2024/04/04 19:23:25 client 2 sent 1 HB
2024/04/04 19:23:25 client 2 got response. time: 46.288µs
2024/04/04 19:23:25 client 2 sent 2 HB
2024/04/04 19:23:25 client 2 got response. time: 36.252µs
2024/04/04 19:23:25 client 2 sent 3 HB
2024/04/04 19:23:25 client 2 got response. time: 53.137µs
2024/04/04 19:23:25 client 2 sent 4 HB
2024/04/04 19:23:25 client 2 got response. time: 34.162µs
2024/04/04 19:23:25 client 2 sent 5 HB
2024/04/04 19:23:25 client 2 got response. time: 40.066µs
2024/04/04 19:23:25 client 2 sent 6 HB
2024/04/04 19:23:25 client 2 got response. time: 34.964µs
2024/04/04 19:23:25 client 2 sent 7 HB
2024/04/04 19:23:25 client 2 got response. time: 39.962µs
2024/04/04 19:23:25 client 2 sent 8 HB
2024/04/04 19:23:25 client 2 got response. time: 38.327µs
2024/04/04 19:23:25 client 2 sent 9 HB
2024/04/04 19:23:25 client 2 got response. time: 38.305µs
2024/04/04 19:23:25 client 2: rtt min/avg/max/mdev = 34.162µs/46.553µs/104.072µs/35µs
2024/04/04 19:23:25 client 2: package loss = 0%
2024/04/04 19:23:25 starting client 3
2024/04/04 19:23:25 client 3 on 127.0.0.1:49960
2024/04/04 19:23:25 client 3 sent 0 HB
2024/04/04 19:23:25 client 3 got response. time: 153.132µs
2024/04/04 19:23:25 client 3 sent 1 HB
2024/04/04 19:23:25 client 3 got response. time: 50.804µs
2024/04/04 19:23:25 client 3 sent 2 HB
2024/04/04 19:23:25 client 3 got response. time: 48.518µs
2024/04/04 19:23:25 client 3 sent 3 HB
2024/04/04 19:23:25 client 3 got response. time: 45.754µs
2024/04/04 19:23:25 client 3 sent 4 HB
2024/04/04 19:23:25 client 3 got response. time: 51.306µs
2024/04/04 19:23:25 client 3 sent 5 HB
2024/04/04 19:23:25 client 3 got response. time: 701.97µs
2024/04/04 19:23:25 client 3 sent 6 HB
2024/04/04 19:23:25 starting client 4
2024/04/04 19:23:25 client 4 on 127.0.0.1:51579
2024/04/04 19:23:25 client 4 sent 0 HB
2024/04/04 19:23:25 client 4 got response. time: 161.345µs
2024/04/04 19:23:25 client 4 sent 1 HB
2024/04/04 19:23:25 client 4 got response. time: 73.268µs
2024/04/04 19:23:25 client 4 sent 2 HB
2024/04/04 19:23:26 client 3 request timed out
2024/04/04 19:23:26 client 3 sent 7 HB
2024/04/04 19:23:26 client 3 got response. time: 249.053µs
2024/04/04 19:23:26 client 3 sent 8 HB
2024/04/04 19:23:26 client 3 got response. time: 170.535µs
2024/04/04 19:23:26 client 3 sent 9 HB
2024/04/04 19:23:26 client 4 request timed out
2024/04/04 19:23:26 client 4 sent 3 HB
2024/04/04 19:23:27 client 3 request timed out
2024/04/04 19:23:27 client 3: rtt min/avg/max/mdev = 45.754µs/183.884µs/701.97µs/195µs
2024/04/04 19:23:27 client 3: package loss = 20%
2024/04/04 19:23:27 client 4 request timed out
2024/04/04 19:23:27 client 4 sent 4 HB
2024/04/04 19:23:27 client 4 got response. time: 323.147µs
2024/04/04 19:23:27 client 4 sent 5 HB
2024/04/04 19:23:27 client 4 got response. time: 226.294µs
2024/04/04 19:23:27 client 4 sent 6 HB
2024/04/04 19:23:27 client 4 got response. time: 155.423µs
2024/04/04 19:23:27 client 4 sent 7 HB
2024/04/04 19:23:28 client 4 request timed out
2024/04/04 19:23:28 client 4 sent 8 HB
2024/04/04 19:23:28 client 4 got response. time: 361.271µs
2024/04/04 19:23:28 client 4 sent 9 HB
2024/04/04 19:23:28 client 4 got response. time: 237.982µs
2024/04/04 19:23:28 client 4: rtt min/avg/max/mdev = 73.268µs/219.818µs/361.271µs/178µs
2024/04/04 19:23:28 client 4: package loss = 30%
```

## Задачи

### Задача 1 (3 балла)
Рассмотрим протоколы GBN и SR. Предположим, пространство порядковых номеров имеет размер $k$.

Постановка задачи: найти наибольшее допустимое окно передачи, которое позволит обойти
возникновение проблемы, показанной на рисунке для каждого из этих протоколов?

<img src="images/task1.png" width=600 />

Описание проблемы:
Отсутствие синхронизации между окнами отправителя и получателя имеет важные последствия,
когда мы сталкиваемся с ограниченностью диапазона порядковых номеров. Рассмотрим, что
могло бы произойти, например, если у нас есть четыре пакета с порядковыми номерами 0, 1, 2, 3,
а размер окна равен трем. Предположим, пакеты с 0 по 2 переданы отправителем, корректно
получены и подтверждены получателем. В этот момент окно получателя заполняется четвертым,
пятым и шестым пакетами, которые имеют порядковые номера 3, 0 и 1, соответственно. Теперь
рассмотрим два сценария.

В первом сценарии (на рисунке сверху) квитанции ACK на первые три пакета доставлены верно.
Таким образом, отправитель сдвигает окно вперед и отправляет четвертый, пятый и шестой
пакеты с порядковыми номерами 3, 0 и 1 соответственно.
Пакет с порядковым номером 3 потерян, но пакет с порядковым номером 0, **содержащий новые данные**, 
получен.

Во втором случае (рисунок снизу) ACK пакеты для первых трех пакетов данных потеряны, и
отправитель пересылает эти пакеты. Таким образом, получатель далее получает пакет с
порядковым номером 0 — **копию первого отправленного**.
Теперь рассмотрим ту же ситуацию с точки зрения принимающей стороны. Действия,
выполняемые передающей стороной, скрыты от нее; принимающая сторона способна лишь
следить за последовательностями получаемых пакетов и генерируемых квитанций. Подобная
ограниченность приводит к тому, что обе описанные выше ситуации воспринимаются
принимающей стороной как одинаковые. Она не может отличить исходную передачу пакета от
повторной.

#### Решение
todo

### Задача 2 (2 балла)
Представим себе следующую ситуацию: один хост расположен в Санкт-Петербурге, а другой — во
Владивостоке. Пусть время оборота RTT между этими двумя хостами приблизительно равно $30$ мс.
Предположим далее, что хосты соединены каналом со скоростью передачи $R$, равной $1$ Гбит/с
($10^9$ бит/с).

Предположим, что размер передаваемого пакета составляет $1500$ байт, включая поля
заголовка и данные.

Насколько большим должен быть размер окна $n$, чтобы использование канала составило
более $98$ процентов?

#### Решение
todo
